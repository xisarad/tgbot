#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è –Ω–∞ –í–ú

TAG=${1:-"latest"}

echo "üöÄ –î–µ–ø–ª–æ–π –≤–µ—Ä—Å–∏–∏ $TAG"

# 1. –ü–æ–ª—É—á–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
git pull origin master --tags

# 2. –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –Ω—É–∂–Ω—ã–π —Ç–µ–≥
git checkout tags/$TAG

# 3. –°–æ–±–∏—Ä–∞–µ–º –æ–±—Ä–∞–∑ —Å —Ç–µ–≥–æ–º
docker build -t telegram-bot:$TAG .

# 4. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ä—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose down

# 5. –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—ã–π
TAG=$TAG docker-compose up -d

echo "‚úÖ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω. –í–µ—Ä—Å–∏—è: $TAG"
